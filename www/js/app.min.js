angular.module("Spasey",["ionic","ngCordova"]).run(function(o){o.ready(function(){console.log("--run"),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),window.StatusBar&&StatusBar.styleDefault()})}).config(function(o,n){console.log("--config"),o.state("map",{url:"/",templateUrl:"templates/map.html",controller:"MapCtrl"}),console.log("cMap"),n.otherwise("/")}).factory("Markers",function(o){console.log("--factory"),console.log("Markers");var n=[];return{getMarkers:function(e){return o.get("http://localhost:8000/markers.php",{params:e}).then(function(o){return n=o})},sendMarkers:function(o){}}}).factory("ConnectivityMonitor",function(o,n){return console.log("ConnectivityMonitor"),{isOnline:function(){return console.log("isOnline"),ionic.Platform.isWebView()?n.isOnline():navigator.onLine},isOffline:function(){return console.log("isOffline"),ionic.Platform.isWebView()?!n.isOnline():!navigator.onLine}}}).factory("GoogleMaps",function(o,n,e,t,l,a){function i(){console.warn("geting into initMap");var n={timeout:1e4,enableHighAccuracy:!0};o.getCurrentPosition(n).then(function(o){var n=new google.maps.LatLng(o.coords.latitude,o.coords.longitude),e={center:n,zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP};y=new google.maps.Map(document.getElementById("map"),e),google.maps.event.addListenerOnce(y,"idle",function(){console.warn("once -- loadMarkers()"),d(),google.maps.event.addListener(y,"dragend",function(){console.log("moved!"),d()}),google.maps.event.addListener(y,"zoom_changed",function(){console.log("zoomed!"),d()}),console.warn("once -- enableMap()"),s()})},function(o){console.log("Could not get location"),d()})}function s(){console.log("enableMap"),n.hide()}function c(){console.log("disableMap"),n.show({template:"You must be connected to the Internet to view this map."})}function r(){console.log("loadGoogleMaps"),n.show({template:"Loading Google Maps"}),window.mapInit=function(){i()};var o=document.createElement("script");o.type="text/javascript",o.id="googleMaps",v?o.src="http://maps.google.com/maps/api/js?key="+v+"&callback=mapInit":o.src="http://maps.google.com/maps/api/js?callback=mapInit",document.body.appendChild(o)}function g(){console.log("checkLoaded"),"undefined"==typeof google||"undefined"==typeof google.maps?r():s()}function d(){console.log("loadMarkers");var o=y.getCenter(),n=y.getBounds(),e=y.getZoom(),t={lat:o.lat(),lng:o.lng()},a={northeast:{lat:n.getNorthEast().lat(),lng:n.getNorthEast().lng()},southwest:{lat:n.getSouthWest().lat(),lng:n.getSouthWest().lng()}},i=u(t,a),s={centre:t,bounds:a,zoom:e,boundingRadius:i};l.getMarkers(s).then(function(o){console.log("Markers: ",o);for(var n=o.data.markers,e=0;e<n.length;e++){var t=n[e];if(!p(t.lat,t.lng)){var l="https://maps.google.com/mapfiles/kml/shapes/",a=new google.maps.LatLng(t.lat,t.lng),i=new google.maps.Marker({map:y,animation:google.maps.Animation.DROP,icon:l+"schools_maps.png",position:a}),s={lat:t.lat,lng:t.lng,marker:i};w.push(s);var c="<h4><small>Road: </small>"+t.road+"</h4><p>Point: "+t.point+"</p><p>Free space: "+t.count+"</p><p>Road infomation: "+t.dict+"</p>";h(i,c,t)}}})}function p(o,n){console.log("markerExists"),console.log("Not yet");for(var e=!1,t=w,l=0;l<t.length;l++)t[l].lat===o&&t[l].lng===n&&(e=!0,console.log("Yes"));return e}function u(o,n){return console.log("getBoundingRadius"),f(o,n.northeast,"miles")}function f(o,n,e){console.log("getDistanceBetweenPoints");var t={miles:3958.8,km:6371},l=t[e||"miles"],a=o.lat,i=o.lng,s=n.lat,c=n.lng,r=m(s-a),g=m(c-i),d=Math.sin(r/2)*Math.sin(r/2)+Math.cos(m(a))*Math.cos(m(s))*Math.sin(g/2)*Math.sin(g/2),p=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),u=l*p;return u}function m(o){return console.log("toRad"),o*Math.PI/180}function h(o,n,e){console.log("addInfoWindow");var t=new google.maps.InfoWindow({content:n});google.maps.event.addListener(o,"click",function(){t.open(y,o)})}function M(){console.log("addConnectivityListeners"),ionic.Platform.isWebView?(e.$on("$cordovaNetwork:online",function(o,n){g(),console.log("device online")}),e.$on("$cordovaNetwork:offline",function(o,n){c(),console.log("device offline")})):(window.addEventListener("online",function(o){g(),console.log("browser online")},!1),window.addEventListener("offline",function(o){c(),console.log("browser offline")},!1))}var w=[],v=!1,y=null;return console.log("GoogleMaps"),{init:function(o){console.log("init"),"undefined"!=typeof o&&(v=o,console.log(v)),"undefined"==typeof google||"undefined"==typeof google.maps?(console.warn("google undefined"),console.warn("Google Maps SDK needs to be loaded"),c(),a.isOnline()&&r()):a.isOnline()?(w=[],i(),s()):c(),M()}}}).controller("MapCtrl",function(o,n,e,t){console.log("--controller"),console.log("Map"),t.init("AIzaSyDt1Hn4Nag4LRzZY-b6Jn0leKDc2ZMwXns"),e.fromTemplateUrl("templates/data.html",{scope:o}).then(function(n){o.modal=n})}).controller("DataCtrl",function(o,n){console.log("Data")});